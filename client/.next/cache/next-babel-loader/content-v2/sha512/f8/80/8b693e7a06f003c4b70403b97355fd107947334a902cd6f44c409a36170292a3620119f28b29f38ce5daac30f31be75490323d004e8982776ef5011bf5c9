{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useCallback, useEffect, useState } from 'react'; // @ts-ignore\n\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Button } from 'antd';\nimport useSWR from 'swr';\nimport { useRouter } from 'next/router';\nimport { fetcher } from '@utils/fetcher';\nimport { FOLLOW_REQUEST, UNFOLLOW_REQUEST } from '../reducers/user';\n\nvar FollowButton = function FollowButton(_ref) {\n  var postData = _ref.postData;\n  var dispatch = useDispatch();\n  var router = useRouter();\n\n  var _useState = useState(false),\n      isFollowing = _useState[0],\n      setIsFollowing = _useState[1];\n\n  var _useSWR = useSWR('/api/user', fetcher),\n      userData = _useSWR.data,\n      userMutate = _useSWR.mutate;\n\n  var _useSelector = useSelector(function (state) {\n    return state.user;\n  }),\n      followLoading = _useSelector.followLoading,\n      unfollowLoading = _useSelector.unfollowLoading,\n      followDone = _useSelector.followDone,\n      unfollowDone = _useSelector.unfollowDone;\n\n  useEffect(function () {\n    if (userData) {\n      setIsFollowing(userData.Followings.find(function (v) {\n        return v.id === postData.User.id;\n      }));\n      console.log('isFollowing', isFollowing);\n    }\n  }, [userData]);\n  useEffect(function () {\n    if (followDone) {\n      userMutate(_objectSpread(_objectSpread({}, userData), {}, {\n        Followings: [].concat(_toConsumableArray(userData.Followings), [{\n          id: postData.User.id\n        }])\n      }));\n    }\n  }, [followDone]);\n  useEffect(function () {\n    if (unfollowDone) {\n      userMutate(_objectSpread(_objectSpread({}, userData), {}, {\n        Followings: userData.Followings.filter(function (v) {\n          return v.id !== postData.User.id;\n        })\n      }));\n    }\n  }, [unfollowDone]);\n  var onClickButton = useCallback(function () {\n    if (!isFollowing) {\n      if (userData) {\n        dispatch({\n          type: FOLLOW_REQUEST,\n          data: postData.User.id\n        });\n      } else {\n        router.push('/login');\n      }\n    } else {\n      dispatch({\n        type: UNFOLLOW_REQUEST,\n        data: postData.User.id\n      });\n    }\n  }, [isFollowing]);\n\n  if (postData.User.id === (userData === null || userData === void 0 ? void 0 : userData.id)) {\n    return null;\n  }\n\n  return /*#__PURE__*/_jsx(Button, {\n    loading: followLoading || unfollowLoading,\n    onClick: onClickButton,\n    type: isFollowing ? 'default' : 'primary',\n    shape: \"round\",\n    block: true,\n    children: isFollowing ? '팔로우 중' : '팔로우 하기'\n  });\n};\n\nexport default FollowButton;","map":{"version":3,"sources":["C:/programming/nodejs/utopia/client/components/FollowButton.tsx"],"names":["React","useCallback","useEffect","useState","useDispatch","useSelector","Button","useSWR","useRouter","fetcher","FOLLOW_REQUEST","UNFOLLOW_REQUEST","FollowButton","postData","dispatch","router","isFollowing","setIsFollowing","userData","data","userMutate","mutate","state","user","followLoading","unfollowLoading","followDone","unfollowDone","Followings","find","v","id","User","console","log","filter","onClickButton","type","push"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\r\n// @ts-ignore\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { Button } from 'antd';\r\nimport useSWR from 'swr';\r\nimport { useRouter } from 'next/router';\r\nimport { fetcher } from '@utils/fetcher';\r\nimport { IPost } from '@typings/IPost';\r\nimport { IUser } from '@typings/IUser';\r\nimport { FOLLOW_REQUEST, UNFOLLOW_REQUEST } from '../reducers/user';\r\n\r\ninterface Props {\r\n  postData: IPost;\r\n}\r\n\r\nconst FollowButton = ({ postData }: Props) => {\r\n  const dispatch = useDispatch();\r\n  const router = useRouter();\r\n\r\n  const [isFollowing, setIsFollowing] = useState(false);\r\n\r\n  const { data: userData, mutate: userMutate } = useSWR('/api/user', fetcher);\r\n\r\n  const { followLoading, unfollowLoading, followDone, unfollowDone } = useSelector((state: any) => state.user);\r\n\r\n  useEffect(() => {\r\n    if (userData) {\r\n      setIsFollowing(userData.Followings.find((v: IUser) => v.id === postData.User.id));\r\n      console.log('isFollowing', isFollowing);\r\n    }\r\n  }, [userData]);\r\n\r\n  useEffect(() => {\r\n    if (followDone) {\r\n      userMutate({\r\n        ...userData,\r\n        Followings: [\r\n          ...userData.Followings,\r\n          {\r\n            id: postData.User.id,\r\n          },\r\n        ],\r\n      });\r\n    }\r\n  }, [followDone]);\r\n\r\n  useEffect(() => {\r\n    if (unfollowDone) {\r\n      userMutate({\r\n        ...userData,\r\n        Followings: userData.Followings.filter((v: IUser) => v.id !== postData.User.id),\r\n      });\r\n    }\r\n  }, [unfollowDone]);\r\n\r\n  const onClickButton = useCallback(() => {\r\n    if (!isFollowing) {\r\n      if (userData) {\r\n        dispatch({\r\n          type: FOLLOW_REQUEST,\r\n          data: postData.User.id,\r\n        });\r\n      } else {\r\n        router.push('/login');\r\n      }\r\n    } else {\r\n      dispatch({\r\n        type: UNFOLLOW_REQUEST,\r\n        data: postData.User.id,\r\n      });\r\n    }\r\n  }, [isFollowing]);\r\n\r\n  if (postData.User.id === userData?.id) {\r\n    return null;\r\n  }\r\n  return (\r\n    <Button\r\n      loading={followLoading || unfollowLoading}\r\n      onClick={onClickButton}\r\n      type={isFollowing ? 'default' : 'primary'}\r\n      shape=\"round\"\r\n      block\r\n    >\r\n      {isFollowing ? '팔로우 중' : '팔로우 하기'}\r\n    </Button>\r\n  );\r\n};\r\n\r\nexport default FollowButton;\r\n"]},"metadata":{},"sourceType":"module"}