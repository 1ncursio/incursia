{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nvar _jsxFileName = \"C:\\\\programming\\\\nodejs\\\\utopia\\\\client\\\\components\\\\FollowButton.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useCallback, useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Button } from 'antd';\nimport useSWR from 'swr';\nimport { useRouter } from 'next/router';\nimport { FOLLOW_REQUEST, UNFOLLOW_REQUEST } from '../reducers/user';\nimport { fetcher } from '@utils/fetcher';\n\nvar FollowButton = function FollowButton(_ref) {\n  _s();\n\n  var postData = _ref.postData;\n  var dispatch = useDispatch();\n  var router = useRouter();\n\n  var _useState = useState(false),\n      isFollowing = _useState[0],\n      setIsFollowing = _useState[1];\n\n  var _useSWR = useSWR('/api/user', fetcher),\n      userData = _useSWR.data,\n      userMutate = _useSWR.mutate;\n\n  var _useSelector = useSelector(function (state) {\n    return state.user;\n  }),\n      followLoading = _useSelector.followLoading,\n      unfollowLoading = _useSelector.unfollowLoading,\n      followDone = _useSelector.followDone,\n      unfollowDone = _useSelector.unfollowDone;\n\n  useEffect(function () {\n    if (userData) {\n      setIsFollowing(userData.Followings.find(function (v) {\n        return v.id === postData.User.id;\n      }));\n      console.log('isFollowing', isFollowing);\n    }\n  }, [userData]);\n  useEffect(function () {\n    if (followDone) {\n      userMutate(_objectSpread(_objectSpread({}, userData), {}, {\n        Followings: [].concat(_toConsumableArray(userData.Followings), [{\n          id: postData.User.id\n        }])\n      }));\n    }\n  }, [followDone]);\n  useEffect(function () {\n    if (unfollowDone) {\n      userMutate(_objectSpread(_objectSpread({}, userData), {}, {\n        Followings: userData.Followings.filter(function (v) {\n          return v.id !== postData.User.id;\n        })\n      }));\n    }\n  }, [unfollowDone]);\n  var onClickButton = useCallback(function () {\n    if (!isFollowing) {\n      if (userData) {\n        dispatch({\n          type: FOLLOW_REQUEST,\n          data: postData.User.id\n        });\n      } else {\n        router.push('/login');\n      }\n    } else {\n      dispatch({\n        type: UNFOLLOW_REQUEST,\n        data: postData.User.id\n      });\n    }\n  }, [isFollowing]);\n\n  if (postData.User.id === (userData === null || userData === void 0 ? void 0 : userData.id)) {\n    return null;\n  }\n\n  return /*#__PURE__*/_jsxDEV(Button, {\n    loading: followLoading || unfollowLoading,\n    onClick: onClickButton,\n    type: isFollowing ? 'default' : 'primary',\n    shape: \"round\",\n    block: true,\n    children: isFollowing ? '팔로우 중' : '팔로우 하기'\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 72,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(FollowButton, \"hgn8pLB+813KFSZR2NO+3VEXr9M=\", false, function () {\n  return [useDispatch, useRouter, useSWR, useSelector];\n});\n\n_c = FollowButton;\nFollowButton.propTypes = {\n  postData: PropTypes.object.isRequired\n};\nexport default FollowButton;\n\nvar _c;\n\n$RefreshReg$(_c, \"FollowButton\");","map":{"version":3,"sources":["C:/programming/nodejs/utopia/client/components/FollowButton.js"],"names":["React","useCallback","useEffect","useState","PropTypes","useDispatch","useSelector","Button","useSWR","useRouter","FOLLOW_REQUEST","UNFOLLOW_REQUEST","fetcher","FollowButton","postData","dispatch","router","isFollowing","setIsFollowing","userData","data","userMutate","mutate","state","user","followLoading","unfollowLoading","followDone","unfollowDone","Followings","find","v","id","User","console","log","filter","onClickButton","type","push","propTypes","object","isRequired"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { Button } from 'antd';\r\nimport useSWR from 'swr';\r\nimport { useRouter } from 'next/router';\r\nimport { FOLLOW_REQUEST, UNFOLLOW_REQUEST } from '../reducers/user';\r\nimport { fetcher } from '@utils/fetcher';\r\n\r\nconst FollowButton = ({ postData }) => {\r\n  const dispatch = useDispatch();\r\n  const router = useRouter();\r\n\r\n  const [isFollowing, setIsFollowing] = useState(false);\r\n\r\n  const { data: userData, mutate: userMutate } = useSWR('/api/user', fetcher);\r\n\r\n  const { followLoading, unfollowLoading, followDone, unfollowDone } = useSelector((state) => state.user);\r\n\r\n  useEffect(() => {\r\n    if (userData) {\r\n      setIsFollowing(userData.Followings.find((v) => v.id === postData.User.id));\r\n      console.log('isFollowing', isFollowing);\r\n    }\r\n  }, [userData]);\r\n\r\n  useEffect(() => {\r\n    if (followDone) {\r\n      userMutate({\r\n        ...userData,\r\n        Followings: [\r\n          ...userData.Followings,\r\n          {\r\n            id: postData.User.id,\r\n          },\r\n        ],\r\n      });\r\n    }\r\n  }, [followDone]);\r\n\r\n  useEffect(() => {\r\n    if (unfollowDone) {\r\n      userMutate({\r\n        ...userData,\r\n        Followings: userData.Followings.filter((v) => v.id !== postData.User.id),\r\n      });\r\n    }\r\n  }, [unfollowDone]);\r\n\r\n  const onClickButton = useCallback(() => {\r\n    if (!isFollowing) {\r\n      if (userData) {\r\n        dispatch({\r\n          type: FOLLOW_REQUEST,\r\n          data: postData.User.id,\r\n        });\r\n      } else {\r\n        router.push('/login');\r\n      }\r\n    } else {\r\n      dispatch({\r\n        type: UNFOLLOW_REQUEST,\r\n        data: postData.User.id,\r\n      });\r\n    }\r\n  }, [isFollowing]);\r\n\r\n  if (postData.User.id === userData?.id) {\r\n    return null;\r\n  }\r\n  return (\r\n    <Button loading={followLoading || unfollowLoading} onClick={onClickButton} type={isFollowing ? 'default' : 'primary'} shape=\"round\" block>\r\n      {isFollowing ? '팔로우 중' : '팔로우 하기'}\r\n    </Button>\r\n  );\r\n};\r\n\r\nFollowButton.propTypes = {\r\n  postData: PropTypes.object.isRequired,\r\n};\r\n\r\nexport default FollowButton;\r\n"]},"metadata":{},"sourceType":"module"}