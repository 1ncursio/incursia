{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"C:\\\\programming\\\\nodejs\\\\utopia\\\\client\\\\components\\\\ProfileForm.tsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useMemo, useCallback } from 'react'; // @ts-ignore\n\nimport { useSelector, useDispatch } from 'react-redux';\nimport { Col, Button, Form, Input, Typography, Modal, Avatar, Upload, message } from 'antd';\nimport ImgCrop from 'antd-img-crop';\nimport useSWR from 'swr';\nimport { fetcher } from '@utils/fetcher';\nimport useInput from '@hooks/useInput';\nimport { CHANGE_PROFILE_REQUEST, CHANGE_NICKNAME_REQUEST, CHANGE_INTRO_REQUEST } from '../reducers/user';\nvar TextArea = Input.TextArea;\nvar Text = Typography.Text;\n\nvar ProfileForm = function ProfileForm() {\n  _s();\n\n  var _useSWR = useSWR('/api/user', fetcher),\n      userData = _useSWR.data,\n      userMutate = _useSWR.mutate;\n\n  var _useSelector = useSelector(function (state) {\n    return state.user;\n  }),\n      changeNicknameLoading = _useSelector.changeNicknameLoading,\n      changeNicknameDone = _useSelector.changeNicknameDone,\n      changeNicknameError = _useSelector.changeNicknameError,\n      changeIntroLoading = _useSelector.changeIntroLoading,\n      changeIntroDone = _useSelector.changeIntroDone,\n      changeIntroError = _useSelector.changeIntroError;\n\n  var _useInput = useInput(''),\n      _useInput2 = _slicedToArray(_useInput, 3),\n      nickname = _useInput2[0],\n      onChangeNickname = _useInput2[1],\n      setNickname = _useInput2[2];\n\n  var _useInput3 = useInput(''),\n      _useInput4 = _slicedToArray(_useInput3, 3),\n      intro = _useInput4[0],\n      onChangeIntro = _useInput4[1],\n      setIntro = _useInput4[2];\n\n  var dispatch = useDispatch();\n  useEffect(function () {\n    if (userData) {\n      setIntro(userData.introduction);\n      setNickname(userData.nickname);\n    }\n  }, [userData === null || userData === void 0 ? void 0 : userData.introduction, userData === null || userData === void 0 ? void 0 : userData.nickname]);\n  useEffect(function () {\n    if (changeNicknameError) {\n      Modal.error({\n        content: '닉네임 변경 중에 오류가 발생했어요.'\n      });\n    }\n  }, [changeNicknameError]);\n  useEffect(function () {\n    if (changeNicknameDone) {\n      Modal.success({\n        content: '닉네임을 변경했어요!'\n      });\n    }\n  }, [changeNicknameDone]);\n  useEffect(function () {\n    if (changeIntroError) {\n      Modal.error({\n        content: '자기소개 변경 중에 오류가 발생했어요.'\n      });\n    }\n  }, [changeIntroError]);\n  useEffect(function () {\n    if (changeIntroDone) {\n      Modal.success({\n        content: '자기소개를 변경했어요!'\n      });\n    }\n  }, [changeIntroDone]);\n  var beforeUpload = useCallback(function (file) {\n    if (file.type !== 'image/jpg' && file.type !== 'image/jpeg' && file.type !== 'image/png') {\n      message.error('jpg jpeg png 사진만 가능해요!');\n      return false;\n    }\n\n    if (file.size > 2 * 1024 * 1024) {\n      message.error('프로필 이미지는 2MB 이하만 가능해요!');\n      return false;\n    }\n\n    var imageFormData = new FormData();\n    imageFormData.append('image', file);\n    dispatch({\n      type: CHANGE_PROFILE_REQUEST,\n      data: imageFormData\n    });\n    return true;\n  }, []);\n  var onSubmitNickname = useCallback(function () {\n    dispatch({\n      type: CHANGE_NICKNAME_REQUEST,\n      data: nickname\n    });\n    userMutate(_objectSpread(_objectSpread({}, userData), {}, {\n      nickname: nickname\n    }), false);\n  }, [nickname]);\n  var onSubmitChangeIntro = useCallback(function () {\n    dispatch({\n      type: CHANGE_INTRO_REQUEST,\n      data: intro\n    });\n    userMutate(_objectSpread(_objectSpread({}, userData), {}, {\n      introduction: intro\n    }), false);\n  }, [intro]);\n  var onUpload = useCallback(function () {\n    userMutate();\n  }, []);\n  var style = useMemo(function () {\n    return {\n      marginBottom: '20px',\n      border: '1px solid #d9d9d9',\n      padding: '20px'\n    };\n  }, []);\n  return /*#__PURE__*/_jsxDEV(Col, {\n    xs: 24,\n    md: 12,\n    children: /*#__PURE__*/_jsxDEV(Form, {\n      style: style,\n      layout: \"vertical\",\n      children: [/*#__PURE__*/_jsxDEV(Form.Item, {\n        style: {\n          textAlign: 'center'\n        },\n        children: /*#__PURE__*/_jsxDEV(ImgCrop, {\n          rotate: true,\n          quality: 0.8,\n          modalTitle: \"\\uC774\\uBBF8\\uC9C0 \\uC870\\uC815\",\n          modalOk: \"\\uC800\\uC7A5\",\n          modalCancel: \"\\uCDE8\\uC18C\",\n          children: /*#__PURE__*/_jsxDEV(Upload, {\n            showUploadList: false,\n            accept: \".jpg,.jpeg,.png\",\n            beforeUpload: beforeUpload,\n            onChange: onUpload,\n            children: userData && /*#__PURE__*/_jsxDEV(Avatar, {\n              src: userData.profile ? \"http://localhost:3100/\".concat(userData.profile) : null,\n              size: 256,\n              children: userData.profile ? null : userData.nickname[0]\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 128,\n              columnNumber: 17\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 126,\n            columnNumber: 13\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(Form.Item, {\n        label: /*#__PURE__*/_jsxDEV(Text, {\n          strong: true,\n          children: \"\\uC774\\uBA54\\uC77C\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 27\n        }, _this),\n        children: /*#__PURE__*/_jsxDEV(Text, {\n          type: \"secondary\",\n          children: userData === null || userData === void 0 ? void 0 : userData.email\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(Form.Item, {\n        label: /*#__PURE__*/_jsxDEV(Text, {\n          strong: true,\n          children: \"\\uB2C9\\uB124\\uC784\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 138,\n          columnNumber: 27\n        }, _this),\n        children: [/*#__PURE__*/_jsxDEV(Input, {\n          value: nickname,\n          onChange: onChangeNickname,\n          maxLength: 20,\n          suffix: /*#__PURE__*/_jsxDEV(Text, {\n            type: \"secondary\",\n            children: \" \".concat(nickname === null || nickname === void 0 ? void 0 : nickname.length, \" / 20\")\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 143,\n            columnNumber: 21\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(Button, {\n          type: \"primary\",\n          onClick: onSubmitNickname,\n          loading: changeNicknameLoading,\n          disabled: (userData === null || userData === void 0 ? void 0 : userData.nickname) === nickname || nickname === '' || nickname.trim() === '',\n          children: \"\\uBCC0\\uACBD\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 11\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(Form.Item, {\n        label: /*#__PURE__*/_jsxDEV(Text, {\n          strong: true,\n          children: \"\\uC790\\uAE30\\uC18C\\uAC1C\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 27\n        }, _this),\n        children: /*#__PURE__*/_jsxDEV(TextArea, {\n          placeholder: \"\\uB2F9\\uC2E0\\uC744 \\uBA4B\\uC9C0\\uAC8C \\uC18C\\uAC1C\\uD574\\uBCF4\\uC138\\uC694!\",\n          value: intro,\n          onChange: onChangeIntro,\n          rows: 5,\n          spellCheck: false,\n          style: {\n            resize: 'none'\n          },\n          showCount: true,\n          maxLength: 500\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(Form.Item, {\n        style: {\n          textAlign: 'center'\n        },\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          type: \"primary\",\n          shape: \"round\",\n          size: \"large\",\n          onClick: onSubmitChangeIntro,\n          loading: changeIntroLoading,\n          disabled: (userData === null || userData === void 0 ? void 0 : userData.introduction) === intro,\n          style: {\n            width: 200\n          },\n          children: \"\\uC800\\uC7A5\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }, _this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 122,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(ProfileForm, \"dg3cVuVccVavKKQP8pvEmV/3HKE=\", false, function () {\n  return [useSWR, useSelector, useInput, useInput, useDispatch];\n});\n\n_c = ProfileForm;\nexport default ProfileForm;\n\nvar _c;\n\n$RefreshReg$(_c, \"ProfileForm\");","map":{"version":3,"sources":["C:/programming/nodejs/utopia/client/components/ProfileForm.tsx"],"names":["React","useEffect","useMemo","useCallback","useSelector","useDispatch","Col","Button","Form","Input","Typography","Modal","Avatar","Upload","message","ImgCrop","useSWR","fetcher","useInput","CHANGE_PROFILE_REQUEST","CHANGE_NICKNAME_REQUEST","CHANGE_INTRO_REQUEST","TextArea","Text","ProfileForm","userData","data","userMutate","mutate","state","user","changeNicknameLoading","changeNicknameDone","changeNicknameError","changeIntroLoading","changeIntroDone","changeIntroError","nickname","onChangeNickname","setNickname","intro","onChangeIntro","setIntro","dispatch","introduction","error","content","success","beforeUpload","file","type","size","imageFormData","FormData","append","onSubmitNickname","onSubmitChangeIntro","onUpload","style","marginBottom","border","padding","textAlign","profile","email","length","trim","resize","width"],"mappings":"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","sourcesContent":["import React, { useEffect, useMemo, useCallback } from 'react';\r\n// @ts-ignore\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { Col, Button, Form, Input, Typography, Modal, Avatar, Upload, message } from 'antd';\r\nimport ImgCrop from 'antd-img-crop';\r\nimport useSWR from 'swr';\r\nimport { fetcher } from '@utils/fetcher';\r\nimport useInput from '@hooks/useInput';\r\nimport { CHANGE_PROFILE_REQUEST, CHANGE_NICKNAME_REQUEST, CHANGE_INTRO_REQUEST } from '../reducers/user';\r\n\r\nconst { TextArea } = Input;\r\nconst { Text } = Typography;\r\n\r\nconst ProfileForm = () => {\r\n  const { data: userData, mutate: userMutate } = useSWR('/api/user', fetcher);\r\n\r\n  const {\r\n    changeNicknameLoading,\r\n    changeNicknameDone,\r\n    changeNicknameError,\r\n    changeIntroLoading,\r\n    changeIntroDone,\r\n    changeIntroError,\r\n  } = useSelector((state: any) => state.user);\r\n\r\n  const [nickname, onChangeNickname, setNickname] = useInput('');\r\n  const [intro, onChangeIntro, setIntro] = useInput('');\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n    if (userData) {\r\n      setIntro(userData.introduction);\r\n      setNickname(userData.nickname);\r\n    }\r\n  }, [userData?.introduction, userData?.nickname]);\r\n\r\n  useEffect(() => {\r\n    if (changeNicknameError) {\r\n      Modal.error({\r\n        content: '닉네임 변경 중에 오류가 발생했어요.',\r\n      });\r\n    }\r\n  }, [changeNicknameError]);\r\n\r\n  useEffect(() => {\r\n    if (changeNicknameDone) {\r\n      Modal.success({\r\n        content: '닉네임을 변경했어요!',\r\n      });\r\n    }\r\n  }, [changeNicknameDone]);\r\n\r\n  useEffect(() => {\r\n    if (changeIntroError) {\r\n      Modal.error({\r\n        content: '자기소개 변경 중에 오류가 발생했어요.',\r\n      });\r\n    }\r\n  }, [changeIntroError]);\r\n\r\n  useEffect(() => {\r\n    if (changeIntroDone) {\r\n      Modal.success({\r\n        content: '자기소개를 변경했어요!',\r\n      });\r\n    }\r\n  }, [changeIntroDone]);\r\n\r\n  const beforeUpload = useCallback((file) => {\r\n    if (file.type !== 'image/jpg' && file.type !== 'image/jpeg' && file.type !== 'image/png') {\r\n      message.error('jpg jpeg png 사진만 가능해요!');\r\n      return false;\r\n    }\r\n    if (file.size > 2 * 1024 * 1024) {\r\n      message.error('프로필 이미지는 2MB 이하만 가능해요!');\r\n      return false;\r\n    }\r\n    const imageFormData = new FormData();\r\n    imageFormData.append('image', file);\r\n\r\n    dispatch({\r\n      type: CHANGE_PROFILE_REQUEST,\r\n      data: imageFormData,\r\n    });\r\n    return true;\r\n  }, []);\r\n\r\n  const onSubmitNickname = useCallback(() => {\r\n    dispatch({\r\n      type: CHANGE_NICKNAME_REQUEST,\r\n      data: nickname,\r\n    });\r\n    userMutate(\r\n      {\r\n        ...userData,\r\n        nickname,\r\n      },\r\n      false,\r\n    );\r\n  }, [nickname]);\r\n\r\n  const onSubmitChangeIntro = useCallback(() => {\r\n    dispatch({\r\n      type: CHANGE_INTRO_REQUEST,\r\n      data: intro,\r\n    });\r\n    userMutate(\r\n      {\r\n        ...userData,\r\n        introduction: intro,\r\n      },\r\n      false,\r\n    );\r\n  }, [intro]);\r\n\r\n  const onUpload = useCallback(() => {\r\n    userMutate();\r\n  }, []);\r\n\r\n  const style = useMemo(() => ({ marginBottom: '20px', border: '1px solid #d9d9d9', padding: '20px' }), []);\r\n  return (\r\n    <Col xs={24} md={12}>\r\n      <Form style={style} layout=\"vertical\">\r\n        <Form.Item style={{ textAlign: 'center' }}>\r\n          <ImgCrop rotate quality={0.8} modalTitle=\"이미지 조정\" modalOk=\"저장\" modalCancel=\"취소\">\r\n            <Upload showUploadList={false} accept=\".jpg,.jpeg,.png\" beforeUpload={beforeUpload} onChange={onUpload}>\r\n              {userData && (\r\n                <Avatar src={userData.profile ? `http://localhost:3100/${userData.profile}` : null} size={256}>\r\n                  {userData.profile ? null : userData.nickname[0]}\r\n                </Avatar>\r\n              )}\r\n            </Upload>\r\n          </ImgCrop>\r\n        </Form.Item>\r\n        <Form.Item label={<Text strong>이메일</Text>}>\r\n          <Text type=\"secondary\">{userData?.email}</Text>\r\n        </Form.Item>\r\n        <Form.Item label={<Text strong>닉네임</Text>}>\r\n          <Input\r\n            value={nickname}\r\n            onChange={onChangeNickname}\r\n            maxLength={20}\r\n            suffix={<Text type=\"secondary\">{` ${nickname?.length} / 20`}</Text>}\r\n          />\r\n          <Button\r\n            type=\"primary\"\r\n            onClick={onSubmitNickname}\r\n            loading={changeNicknameLoading}\r\n            disabled={userData?.nickname === nickname || nickname === '' || nickname.trim() === ''}\r\n          >\r\n            변경\r\n          </Button>\r\n        </Form.Item>\r\n        <Form.Item label={<Text strong>자기소개</Text>}>\r\n          <TextArea\r\n            placeholder=\"당신을 멋지게 소개해보세요!\"\r\n            value={intro}\r\n            onChange={onChangeIntro}\r\n            rows={5}\r\n            spellCheck={false}\r\n            style={{ resize: 'none' }}\r\n            showCount\r\n            maxLength={500}\r\n          />\r\n        </Form.Item>\r\n        <Form.Item style={{ textAlign: 'center' }}>\r\n          <Button\r\n            type=\"primary\"\r\n            shape=\"round\"\r\n            size=\"large\"\r\n            onClick={onSubmitChangeIntro}\r\n            loading={changeIntroLoading}\r\n            disabled={userData?.introduction === intro}\r\n            style={{\r\n              width: 200,\r\n            }}\r\n          >\r\n            저장\r\n          </Button>\r\n        </Form.Item>\r\n      </Form>\r\n    </Col>\r\n  );\r\n};\r\n\r\nexport default ProfileForm;\r\n"]},"metadata":{},"sourceType":"module"}