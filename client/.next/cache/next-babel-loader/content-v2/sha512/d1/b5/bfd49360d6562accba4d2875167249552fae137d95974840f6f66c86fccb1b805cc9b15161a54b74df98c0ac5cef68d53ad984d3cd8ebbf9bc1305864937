{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport React, { useEffect, useCallback, useState } from 'react';\nimport { Col, Form, Input, Button, Typography, Upload, message, Modal, Row } from 'antd'; // @ts-ignore\n\nimport { useDispatch, useSelector } from 'react-redux';\nimport Router from 'next/router';\nimport { PlusOutlined } from '@ant-design/icons';\nimport useSWR from 'swr';\nimport useInput from '@hooks/useInput';\nimport AppLayout from '@components/AppLayout';\nimport TagForm from '@components/TagForm';\nimport { fetcher } from '@utils/fetcher';\nimport ExpiredValidation from '@components/ExpiredValidation';\nimport { UPLOAD_IMAGES_REQUEST, ADD_POST_REQUEST, REMOVE_IMAGE } from '../reducers/post'; // const { Option } = Select;\n\nvar Paragraph = Typography.Paragraph;\nvar TextArea = Input.TextArea;\n\nfunction getBase64(file) {\n  return new Promise(function (resolve, reject) {\n    var reader = new FileReader();\n    reader.readAsDataURL(file);\n\n    reader.onload = function () {\n      return resolve(reader.result);\n    };\n\n    reader.onerror = function (error) {\n      return reject(error);\n    };\n  });\n}\n\nvar upload = function upload() {\n  var dispatch = useDispatch();\n\n  var _useSWR = useSWR('/api/user', fetcher),\n      userData = _useSWR.data; // @ts-ignore\n\n\n  var _useSelector = useSelector(function (state) {\n    return state.post;\n  }),\n      imagePaths = _useSelector.imagePaths,\n      addedPostId = _useSelector.addedPostId;\n\n  useEffect(function () {\n    if (!userData) {\n      Router.replace('/login');\n    }\n  }, [userData]);\n  useEffect(function () {\n    if (addedPostId) {\n      Router.replace(\"/illustration/\".concat(addedPostId));\n    }\n  }, [addedPostId]);\n\n  var _useInput = useInput(''),\n      _useInput2 = _slicedToArray(_useInput, 2),\n      title = _useInput2[0],\n      onChangeTitle = _useInput2[1];\n\n  var _useInput3 = useInput(''),\n      _useInput4 = _slicedToArray(_useInput3, 2),\n      caption = _useInput4[0],\n      onChangeCaption = _useInput4[1];\n\n  var _useState = useState([]),\n      tags = _useState[0],\n      setTags = _useState[1];\n\n  var _useState2 = useState([]),\n      fileList = _useState2[0],\n      setFileList = _useState2[1];\n\n  var _useState3 = useState(0),\n      fileSize = _useState3[0],\n      setFileSize = _useState3[1];\n\n  var _useState4 = useState(''),\n      previewImage = _useState4[0],\n      setPreviewImage = _useState4[1];\n\n  var _useState5 = useState(''),\n      previewTitle = _useState5[0],\n      setPreviewTitle = _useState5[1];\n\n  var _useState6 = useState(false),\n      previewVisible = _useState6[0],\n      setPreviewVisible = _useState6[1];\n\n  var onCancel = useCallback(function () {\n    setPreviewVisible(false);\n  }, []);\n  var onPreview = useCallback( /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(file) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              console.log(file.originFileObj);\n\n              if (!(!file.url && !file.preview)) {\n                _context.next = 5;\n                break;\n              }\n\n              _context.next = 4;\n              return getBase64(file.originFileObj);\n\n            case 4:\n              file.preview = _context.sent;\n\n            case 5:\n              setPreviewImage(file.url || file.preview);\n              setPreviewVisible(true);\n              setPreviewTitle(file.name || file.url.substring(file.url.lastIndexOf('/') + 1));\n              console.log(file);\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }(), []);\n  var onChangeFileList = useCallback(function (_ref2) {\n    var newFileList = _ref2.fileList;\n    console.log(newFileList);\n    setFileList(newFileList);\n    var fileSizes = newFileList.map(function (file) {\n      return file.size;\n    });\n    setFileSize(Math.round(fileSizes.reduce(function (p, c) {\n      return p + c;\n    }, 0) / 1024 / 1024 * 100) / 100);\n  }, []);\n  var onRemoveFile = useCallback(function (file) {\n    var fileIndex = fileList.findIndex(function (v) {\n      return v === file;\n    });\n    console.log(fileIndex);\n    dispatch({\n      type: REMOVE_IMAGE,\n      data: fileIndex\n    });\n  }, [fileList]);\n  var beforeUpload = useCallback(function (file) {\n    if (file.type !== 'image/jpg' && file.type !== 'image/jpeg' && file.type !== 'image/png') {\n      message.error('jpg jpeg png 사진만 가능해요!');\n      return false;\n    }\n\n    if (file.size > 10 * 1024 * 1024) {\n      message.error('이미지는 10MB 이하만 가능해요!');\n      return false;\n    }\n\n    var imageFormData = new FormData();\n    imageFormData.append('image', file);\n    dispatch({\n      type: UPLOAD_IMAGES_REQUEST,\n      data: imageFormData\n    });\n    return true;\n  }, []);\n  var onFinish = useCallback(function () {\n    console.log({\n      title: title,\n      caption: caption,\n      tags: tags,\n      imagePaths: imagePaths\n    });\n    dispatch({\n      type: ADD_POST_REQUEST,\n      data: {\n        title: title,\n        caption: caption,\n        tags: tags,\n        imagePaths: imagePaths\n      }\n    }); // Router.replace(`/illustration/${addedPostId}`)\n  }, [title, caption, tags, imagePaths]);\n\n  var uploadButton = /*#__PURE__*/_jsxs(\"div\", {\n    children: [/*#__PURE__*/_jsx(PlusOutlined, {}), /*#__PURE__*/_jsx(\"div\", {\n      style: {\n        marginTop: 8\n      },\n      children: \"\\uC5C5\\uB85C\\uB4DC\"\n    })]\n  });\n\n  if ((userData === null || userData === void 0 ? void 0 : userData.status) === 'pending') {\n    return /*#__PURE__*/_jsx(ExpiredValidation, {});\n  }\n\n  return /*#__PURE__*/_jsx(AppLayout, {\n    children: /*#__PURE__*/_jsx(Row, {\n      justify: \"center\",\n      gutter: 16,\n      children: /*#__PURE__*/_jsx(Col, {\n        span: 12,\n        children: /*#__PURE__*/_jsxs(Form, {\n          onFinish: onFinish,\n          children: [/*#__PURE__*/_jsxs(Form.Item, {\n            children: [/*#__PURE__*/_jsx(Paragraph, {\n              children: \"JPG JPEG GIF PNG\"\n            }), /*#__PURE__*/_jsx(Paragraph, {\n              children: \"1\\uC7A5\\uB2F9 10MB \\uC774\\uB0B4, \\uCD5C\\uB300 20\\uC7A5 \\uC5C5\\uB85C\\uB4DC\"\n            }), /*#__PURE__*/_jsx(Paragraph, {\n              children: \"\".concat(fileList.length, \"\\uC7A5 \").concat(fileSize, \"MB\")\n            }), /*#__PURE__*/_jsx(Upload, {\n              name: \"image\",\n              accept: \".jpg,.jpeg,.png,.gif\",\n              multiple: true,\n              maxCount: 20,\n              beforeUpload: beforeUpload,\n              onPreview: onPreview,\n              onChange: onChangeFileList,\n              listType: \"picture-card\",\n              fileList: fileList,\n              onRemove: onRemoveFile,\n              children: fileList.length >= 20 ? null : uploadButton\n            }), /*#__PURE__*/_jsx(Modal, {\n              visible: previewVisible,\n              title: previewTitle,\n              footer: null,\n              onCancel: onCancel,\n              children: /*#__PURE__*/_jsx(\"img\", {\n                alt: \"example\",\n                style: {\n                  width: '100%'\n                },\n                src: previewImage\n              })\n            })]\n          }), /*#__PURE__*/_jsx(Form.Item, {\n            children: /*#__PURE__*/_jsx(Input, {\n              type: \"text\",\n              value: title,\n              onChange: onChangeTitle,\n              placeholder: \"\\uD0C0\\uC774\\uD2C0\"\n            })\n          }), /*#__PURE__*/_jsx(Form.Item, {\n            children: /*#__PURE__*/_jsx(TextArea, {\n              rows: 5,\n              placeholder: \"\\uCEA1\\uC158\",\n              value: caption,\n              onChange: onChangeCaption\n            })\n          }), /*#__PURE__*/_jsx(Form.Item, {\n            children: /*#__PURE__*/_jsx(TagForm, {\n              tags: tags,\n              setTags: setTags\n            })\n          }), /*#__PURE__*/_jsxs(Form.Item, {\n            children: [/*#__PURE__*/_jsx(Paragraph, {\n              children: \"\\uC544\\uB798\\uC5D0 \\uD574\\uB2F9\\uD558\\uB294 \\uC791\\uD488\\uC758 \\uC5C5\\uB85C\\uB4DC\\uB97C \\uAE08\\uC9C0\\uD569\\uB2C8\\uB2E4. \\uC5C5\\uB85C\\uB4DC\\uD558\\uC2DC\\uAE30 \\uC804\\uC5D0 \\uD655\\uC778\\uD574\\uC8FC\\uC138\\uC694.\"\n            }), /*#__PURE__*/_jsx(Paragraph, {\n              children: \"\\uD0C0\\uC778\\uC774 \\uC81C\\uC791\\uD55C \\uC791\\uD488, \\uC2DC\\uD310\\uB418\\uB294 \\uC0C1\\uD488\\uC758 \\uC774\\uBBF8\\uC9C0, \\uC81C\\uC0BC\\uC790\\uAC00 \\uAD8C\\uB9AC\\uB97C \\uC18C\\uC720\\uD55C \\uC774\\uBBF8\\uC9C0, \\uAC8C\\uC784 \\uBC0F \\uC601\\uC0C1 \\uC791\\uD488\\uC758 \\uCEA1\\uCC98, \\uC2A4\\uD06C\\uB9B0\\uC20F \\uC774\\uBBF8\\uC9C0\\uAC00 \\uD3EC\\uD568\\uB41C \\uC791\\uD488.\"\n            }), /*#__PURE__*/_jsx(Paragraph, {\n              children: \"\\uC704\\uC640 \\uAC19\\uC740 \\uC774\\uBBF8\\uC9C0\\uB97C \\uC720\\uC6A9\\uD558\\uC5EC, \\uCC98\\uC74C\\uBD80\\uD130 \\uBAA8\\uB4E0 \\uAC83\\uC744 \\uBCF8\\uC778\\uC774 \\uC9C1\\uC811 \\uADF8\\uB9AC\\uC9C0 \\uC54A\\uC740 \\uC791\\uD488.\"\n            }), /*#__PURE__*/_jsx(Paragraph, {\n              children: \"\\uC791\\uD488 \\uC774\\uC678\\uC758 \\uD53C\\uC0AC\\uCCB4\\uB97C \\uCC0D\\uC740 \\uC0AC\\uC9C4 \\uC774\\uBBF8\\uC9C0.\"\n            }), /*#__PURE__*/_jsx(Paragraph, {\n              children: \"\\uC774\\uC6A9\\uC57D\\uAD00\\uC5D0 \\uC704\\uBC18\\uD558\\uB294 \\uC791\\uD488\\uC758 \\uD22C\\uACE0 \\uC720\\uC800\\uB294 \\uD22C\\uACE0 \\uC791\\uD488 \\uACF5\\uAC1C \\uC815\\uC9C0, \\uACC4\\uC815 \\uC815\\uC9C0\\uC758 \\uB300\\uC0C1\\uC774 \\uB429\\uB2C8\\uB2E4.\"\n            })]\n          }), /*#__PURE__*/_jsx(Form.Item, {\n            children: /*#__PURE__*/_jsx(Button, {\n              type: \"primary\",\n              htmlType: \"submit\",\n              children: \"\\uC5C5\\uB85C\\uB4DC\\uD558\\uAE30\"\n            })\n          })]\n        })\n      })\n    })\n  });\n};\n\nexport default upload;","map":{"version":3,"sources":["C:/programming/nodejs/utopia/client/pages/upload.tsx"],"names":["React","useEffect","useCallback","useState","Col","Form","Input","Button","Typography","Upload","message","Modal","Row","useDispatch","useSelector","Router","PlusOutlined","useSWR","useInput","AppLayout","TagForm","fetcher","ExpiredValidation","UPLOAD_IMAGES_REQUEST","ADD_POST_REQUEST","REMOVE_IMAGE","Paragraph","TextArea","getBase64","file","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","result","onerror","error","upload","dispatch","userData","data","state","post","imagePaths","addedPostId","replace","title","onChangeTitle","caption","onChangeCaption","tags","setTags","fileList","setFileList","fileSize","setFileSize","previewImage","setPreviewImage","previewTitle","setPreviewTitle","previewVisible","setPreviewVisible","onCancel","onPreview","console","log","originFileObj","url","preview","name","substring","lastIndexOf","onChangeFileList","newFileList","fileSizes","map","size","Math","round","reduce","p","c","onRemoveFile","fileIndex","findIndex","v","type","beforeUpload","imageFormData","FormData","append","onFinish","uploadButton","marginTop","status","length","width"],"mappings":"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","sourcesContent":["import React, { useEffect, useCallback, useState } from 'react';\r\nimport { Col, Form, Input, Button, Typography, Upload, message, Modal, Row } from 'antd';\r\n// @ts-ignore\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport Router from 'next/router';\r\nimport { PlusOutlined } from '@ant-design/icons';\r\nimport useSWR from 'swr';\r\nimport useInput from '@hooks/useInput';\r\nimport AppLayout from '@components/AppLayout';\r\nimport TagForm from '@components/TagForm';\r\nimport { fetcher } from '@utils/fetcher';\r\nimport ExpiredValidation from '@components/ExpiredValidation';\r\nimport { UPLOAD_IMAGES_REQUEST, ADD_POST_REQUEST, REMOVE_IMAGE } from '../reducers/post';\r\n\r\n// const { Option } = Select;\r\nconst { Paragraph } = Typography;\r\nconst { TextArea } = Input;\r\n\r\nfunction getBase64(file: Blob) {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.readAsDataURL(file);\r\n    reader.onload = () => resolve(reader.result);\r\n    reader.onerror = (error) => reject(error);\r\n  });\r\n}\r\n\r\nconst upload = () => {\r\n  const dispatch = useDispatch();\r\n\r\n  const { data: userData } = useSWR('/api/user', fetcher);\r\n  // @ts-ignore\r\n  const { imagePaths, addedPostId } = useSelector((state) => state.post);\r\n\r\n  useEffect(() => {\r\n    if (!userData) {\r\n      Router.replace('/login');\r\n    }\r\n  }, [userData]);\r\n\r\n  useEffect(() => {\r\n    if (addedPostId) {\r\n      Router.replace(`/illustration/${addedPostId}`);\r\n    }\r\n  }, [addedPostId]);\r\n\r\n  const [title, onChangeTitle] = useInput('');\r\n  const [caption, onChangeCaption] = useInput('');\r\n  const [tags, setTags] = useState<string[]>([]);\r\n  const [fileList, setFileList] = useState([]);\r\n  const [fileSize, setFileSize] = useState(0);\r\n  const [previewImage, setPreviewImage] = useState('');\r\n  const [previewTitle, setPreviewTitle] = useState('');\r\n  const [previewVisible, setPreviewVisible] = useState(false);\r\n\r\n  const onCancel = useCallback(() => {\r\n    setPreviewVisible(false);\r\n  }, []);\r\n\r\n  const onPreview = useCallback(async (file) => {\r\n    console.log(file.originFileObj);\r\n    if (!file.url && !file.preview) {\r\n      file.preview = await getBase64(file.originFileObj);\r\n    }\r\n    setPreviewImage(file.url || file.preview);\r\n    setPreviewVisible(true);\r\n    setPreviewTitle(file.name || file.url.substring(file.url.lastIndexOf('/') + 1));\r\n    console.log(file);\r\n  }, []);\r\n\r\n  const onChangeFileList = useCallback(({ fileList: newFileList }) => {\r\n    console.log(newFileList);\r\n    setFileList(newFileList);\r\n    const fileSizes = newFileList.map((file: Blob) => file.size);\r\n    setFileSize(Math.round((fileSizes.reduce((p: number, c: number) => p + c, 0) / 1024 / 1024) * 100) / 100);\r\n  }, []);\r\n\r\n  const onRemoveFile = useCallback(\r\n    (file) => {\r\n      const fileIndex = fileList.findIndex((v) => v === file);\r\n      console.log(fileIndex);\r\n      dispatch({\r\n        type: REMOVE_IMAGE,\r\n        data: fileIndex,\r\n      });\r\n    },\r\n    [fileList],\r\n  );\r\n\r\n  const beforeUpload = useCallback((file) => {\r\n    if (file.type !== 'image/jpg' && file.type !== 'image/jpeg' && file.type !== 'image/png') {\r\n      message.error('jpg jpeg png 사진만 가능해요!');\r\n      return false;\r\n    }\r\n    if (file.size > 10 * 1024 * 1024) {\r\n      message.error('이미지는 10MB 이하만 가능해요!');\r\n      return false;\r\n    }\r\n    const imageFormData = new FormData();\r\n    imageFormData.append('image', file);\r\n\r\n    dispatch({\r\n      type: UPLOAD_IMAGES_REQUEST,\r\n      data: imageFormData,\r\n    });\r\n\r\n    return true;\r\n  }, []);\r\n\r\n  const onFinish = useCallback(() => {\r\n    console.log({ title, caption, tags, imagePaths });\r\n\r\n    dispatch({\r\n      type: ADD_POST_REQUEST,\r\n      data: {\r\n        title,\r\n        caption,\r\n        tags,\r\n        imagePaths,\r\n      },\r\n    });\r\n    // Router.replace(`/illustration/${addedPostId}`)\r\n  }, [title, caption, tags, imagePaths]);\r\n\r\n  const uploadButton = (\r\n    <div>\r\n      <PlusOutlined />\r\n      <div style={{ marginTop: 8 }}>업로드</div>\r\n    </div>\r\n  );\r\n\r\n  if (userData?.status === 'pending') {\r\n    return <ExpiredValidation />;\r\n  }\r\n\r\n  return (\r\n    <AppLayout>\r\n      <Row justify=\"center\" gutter={16}>\r\n        <Col span={12}>\r\n          <Form onFinish={onFinish}>\r\n            <Form.Item>\r\n              <Paragraph>JPG JPEG GIF PNG</Paragraph>\r\n              <Paragraph>1장당 10MB 이내, 최대 20장 업로드</Paragraph>\r\n              <Paragraph>{`${fileList.length}장 ${fileSize}MB`}</Paragraph>\r\n              <Upload\r\n                name=\"image\"\r\n                accept=\".jpg,.jpeg,.png,.gif\"\r\n                multiple\r\n                maxCount={20}\r\n                beforeUpload={beforeUpload}\r\n                onPreview={onPreview}\r\n                onChange={onChangeFileList}\r\n                listType=\"picture-card\"\r\n                fileList={fileList}\r\n                onRemove={onRemoveFile}\r\n              >\r\n                {fileList.length >= 20 ? null : uploadButton}\r\n              </Upload>\r\n              <Modal visible={previewVisible} title={previewTitle} footer={null} onCancel={onCancel}>\r\n                <img alt=\"example\" style={{ width: '100%' }} src={previewImage} />\r\n              </Modal>\r\n            </Form.Item>\r\n            <Form.Item>\r\n              <Input type=\"text\" value={title} onChange={onChangeTitle} placeholder=\"타이틀\" />\r\n            </Form.Item>\r\n            <Form.Item>\r\n              <TextArea rows={5} placeholder=\"캡션\" value={caption} onChange={onChangeCaption} />\r\n            </Form.Item>\r\n            <Form.Item>\r\n              <TagForm tags={tags} setTags={setTags} />\r\n            </Form.Item>\r\n            {/* <Form.Item>\r\n          <Select defaultValue=\"public\" value>\r\n            <Option value=\"public\">전체 공개</Option>\r\n            <Option value=\"my\" disabled>\r\n              마이픽 공개\r\n            </Option>\r\n            <Option value=\"private\">비공개</Option>\r\n          </Select>\r\n        </Form.Item> */}\r\n            <Form.Item>\r\n              <Paragraph>아래에 해당하는 작품의 업로드를 금지합니다. 업로드하시기 전에 확인해주세요.</Paragraph>\r\n              <Paragraph>\r\n                타인이 제작한 작품, 시판되는 상품의 이미지, 제삼자가 권리를 소유한 이미지, 게임 및 영상 작품의 캡처,\r\n                스크린숏 이미지가 포함된 작품.\r\n              </Paragraph>\r\n              <Paragraph>위와 같은 이미지를 유용하여, 처음부터 모든 것을 본인이 직접 그리지 않은 작품.</Paragraph>\r\n              <Paragraph>작품 이외의 피사체를 찍은 사진 이미지.</Paragraph>\r\n              <Paragraph>\r\n                이용약관에 위반하는 작품의 투고 유저는 투고 작품 공개 정지, 계정 정지의 대상이 됩니다.\r\n              </Paragraph>\r\n            </Form.Item>\r\n            <Form.Item>\r\n              <Button type=\"primary\" htmlType=\"submit\">\r\n                업로드하기\r\n              </Button>\r\n            </Form.Item>\r\n          </Form>\r\n        </Col>\r\n      </Row>\r\n    </AppLayout>\r\n  );\r\n};\r\n\r\nexport default upload;\r\n"]},"metadata":{},"sourceType":"module"}