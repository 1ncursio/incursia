{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"C:\\\\programming\\\\nodejs\\\\utopia\\\\client\\\\components\\\\CommentSection\\\\index.tsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport { Avatar, List, Modal, Tooltip } from 'antd';\nimport moment from 'moment';\nimport React, { useCallback, useState } from 'react'; // @ts-ignore\n\nimport { useDispatch } from 'react-redux';\nimport Link from 'next/link';\nimport PropTypes from 'prop-types';\nimport { DeleteOutlined } from '@ant-design/icons';\nimport useSWR from 'swr';\nimport { fetcher } from '@utils/fetcher';\nimport CommentContent from '@components/CommentContent';\nimport { REMOVE_COMMENT_REQUEST } from '../../reducers/post';\nimport CommentForm from '../CommentForm';\nimport CommentWrapper from './styles';\nmoment.locale('ko');\n\nvar CommentSection = function CommentSection(_ref) {\n  _s();\n\n  var postData = _ref.postData,\n      postMutate = _ref.postMutate;\n  var dispatch = useDispatch();\n\n  var _useState = useState(-1),\n      replyId = _useState[0],\n      setReplyId = _useState[1];\n\n  var _useSWR = useSWR('/api/user', fetcher),\n      userData = _useSWR.data;\n\n  var toggleReplyForm = useCallback(function (id) {\n    console.log('toggleReplyForm called');\n\n    if (id !== replyId) {\n      setReplyId(id);\n      console.log(\"\".concat(id, \" !== \").concat(replyId));\n    } else {\n      setReplyId(-1);\n      console.log(\"\".concat(id, \" === \").concat(replyId));\n    }\n  }, [replyId]);\n  var onDeleteComment = useCallback(function (commentId) {\n    Modal.confirm({\n      content: '정말로 이 댓글을 삭제하시겠어요?',\n      okText: '삭제',\n      cancelText: '취소',\n      onOk: function onOk() {\n        dispatch({\n          type: REMOVE_COMMENT_REQUEST,\n          data: commentId\n        });\n      }\n    });\n  }, []);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(CommentForm, {\n      placeholder: \"\\uB313\\uAE00 \\uB2EC\\uAE30\",\n      type: \"comment\",\n      setReplyId: setReplyId,\n      postData: postData,\n      postMutate: postMutate\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 7\n    }, _this), (postData === null || postData === void 0 ? void 0 : postData.Comments) && /*#__PURE__*/_jsxDEV(List, {\n      header: \"\".concat(postData.Comments.length, \"\\uAC1C\\uC758 \\uB313\\uAE00\"),\n      itemLayout: \"horizontal\",\n      dataSource: postData.Comments,\n      renderItem: function renderItem(item) {\n        return /*#__PURE__*/_jsxDEV(\"li\", {\n          children: /*#__PURE__*/_jsxDEV(CommentWrapper, {\n            nested: +(item.id !== item.replyId),\n            actions: [/*#__PURE__*/_jsxDEV(\"span\", {\n              onClick: function onClick() {\n                return toggleReplyForm(item.id);\n              },\n              children: \"\\uB2F5\\uAE00\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 72,\n              columnNumber: 19\n            }, _this), /*#__PURE__*/_jsxDEV(Tooltip, {\n              title: \"\\uC0AD\\uC81C\",\n              children: item.User.id === (userData === null || userData === void 0 ? void 0 : userData.id) && /*#__PURE__*/_jsxDEV(DeleteOutlined, {\n                onClick: function onClick() {\n                  return onDeleteComment(item.id);\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 73,\n                columnNumber: 73\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 73,\n              columnNumber: 19\n            }, _this)],\n            author: /*#__PURE__*/_jsxDEV(Link, {\n              href: \"/user/\".concat(item.User.id, \"/illustration\"),\n              children: /*#__PURE__*/_jsxDEV(\"a\", {\n                children: item.User.nickname\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 77,\n                columnNumber: 21\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 76,\n              columnNumber: 19\n            }, _this),\n            avatar: /*#__PURE__*/_jsxDEV(Link, {\n              href: \"/user/\".concat(item.User.id, \"/illustration\"),\n              children: /*#__PURE__*/_jsxDEV(\"a\", {\n                children: /*#__PURE__*/_jsxDEV(Avatar, {\n                  src: item.User.profile && \"http://localhost:3100/\".concat(item.User.profile),\n                  children: !item.User.profile && item.User.nickname[0]\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 83,\n                  columnNumber: 23\n                }, _this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 82,\n                columnNumber: 21\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 81,\n              columnNumber: 19\n            }, _this),\n            datetime: /*#__PURE__*/_jsxDEV(Tooltip, {\n              title: moment(item.createdAt).format('YYYY년 MM월 DD일 HH:mm'),\n              children: /*#__PURE__*/_jsxDEV(\"span\", {\n                children: moment(item.createdAt).fromNow()\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 91,\n                columnNumber: 21\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 90,\n              columnNumber: 19\n            }, _this),\n            content: /*#__PURE__*/_jsxDEV(CommentContent, {\n              content: item.content\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 94,\n              columnNumber: 26\n            }, _this),\n            children: replyId === item.id && /*#__PURE__*/_jsxDEV(CommentForm, {\n              placeholder: \"\\uB2F5\\uAE00 \\uB2EC\\uAE30\",\n              type: \"reply\",\n              setReplyId: setReplyId,\n              replyId: replyId,\n              postData: postData,\n              postMutate: postMutate\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 97,\n              columnNumber: 19\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 69,\n            columnNumber: 15\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 13\n        }, _this);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 9\n    }, _this)]\n  }, void 0, true);\n};\n\n_s(CommentSection, \"sgumAwAdt3wWFJChZgeKanDAaTg=\", false, function () {\n  return [useDispatch, useSWR];\n});\n\n_c = CommentSection;\nCommentSection.propTypes = {\n  postData: PropTypes.object.isRequired,\n  postMutate: PropTypes.func.isRequired\n};\nexport default CommentSection;\n\nvar _c;\n\n$RefreshReg$(_c, \"CommentSection\");","map":{"version":3,"sources":["C:/programming/nodejs/utopia/client/components/CommentSection/index.tsx"],"names":["Avatar","List","Modal","Tooltip","moment","React","useCallback","useState","useDispatch","Link","PropTypes","DeleteOutlined","useSWR","fetcher","CommentContent","REMOVE_COMMENT_REQUEST","CommentForm","CommentWrapper","locale","CommentSection","postData","postMutate","dispatch","replyId","setReplyId","userData","data","toggleReplyForm","id","console","log","onDeleteComment","commentId","confirm","content","okText","cancelText","onOk","type","Comments","length","item","User","nickname","profile","createdAt","format","fromNow","propTypes","object","isRequired","func"],"mappings":"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","sourcesContent":["import { Avatar, List, Modal, Tooltip } from 'antd';\r\nimport moment from 'moment';\r\nimport React, { useCallback, useState } from 'react';\r\n// @ts-ignore\r\nimport { useDispatch } from 'react-redux';\r\nimport Link from 'next/link';\r\nimport PropTypes from 'prop-types';\r\nimport { DeleteOutlined } from '@ant-design/icons';\r\nimport useSWR from 'swr';\r\nimport { fetcher } from '@utils/fetcher';\r\nimport CommentContent from '@components/CommentContent';\r\nimport { IPost } from '@typings/db';\r\nimport { REMOVE_COMMENT_REQUEST } from '../../reducers/post';\r\nimport CommentForm from '../CommentForm';\r\nimport CommentWrapper from './styles';\r\n\r\nmoment.locale('ko');\r\n\r\ninterface Props {\r\n  postData: IPost;\r\n  postMutate: any;\r\n}\r\n\r\nconst CommentSection = ({ postData, postMutate }: Props) => {\r\n  const dispatch = useDispatch();\r\n\r\n  const [replyId, setReplyId] = useState(-1);\r\n\r\n  const { data: userData } = useSWR('/api/user', fetcher);\r\n\r\n  const toggleReplyForm = useCallback(\r\n    (id) => {\r\n      console.log('toggleReplyForm called');\r\n      if (id !== replyId) {\r\n        setReplyId(id);\r\n        console.log(`${id} !== ${replyId}`);\r\n      } else {\r\n        setReplyId(-1);\r\n        console.log(`${id} === ${replyId}`);\r\n      }\r\n    },\r\n    [replyId]\r\n  );\r\n\r\n  const onDeleteComment = useCallback((commentId) => {\r\n    Modal.confirm({\r\n      content: '정말로 이 댓글을 삭제하시겠어요?',\r\n      okText: '삭제',\r\n      cancelText: '취소',\r\n      onOk: () => {\r\n        dispatch({\r\n          type: REMOVE_COMMENT_REQUEST,\r\n          data: commentId,\r\n        });\r\n      },\r\n    });\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n      <CommentForm placeholder=\"댓글 달기\" type=\"comment\" setReplyId={setReplyId} postData={postData} postMutate={postMutate} />\r\n      {postData?.Comments && (\r\n        <List\r\n          header={`${postData.Comments.length}개의 댓글`}\r\n          itemLayout=\"horizontal\"\r\n          dataSource={postData.Comments}\r\n          renderItem={(item) => (\r\n            <li>\r\n              <CommentWrapper\r\n                nested={+(item.id !== item.replyId)}\r\n                actions={[\r\n                  <span onClick={() => toggleReplyForm(item.id)}>답글</span>,\r\n                  <Tooltip title=\"삭제\">{item.User.id === userData?.id && <DeleteOutlined onClick={() => onDeleteComment(item.id)} />}</Tooltip>,\r\n                ]}\r\n                author={\r\n                  <Link href={`/user/${item.User.id}/illustration`}>\r\n                    <a>{item.User.nickname}</a>\r\n                  </Link>\r\n                }\r\n                avatar={\r\n                  <Link href={`/user/${item.User.id}/illustration`}>\r\n                    <a>\r\n                      <Avatar src={item.User.profile && `http://localhost:3100/${item.User.profile}`}>\r\n                        {!item.User.profile && item.User.nickname[0]}\r\n                      </Avatar>\r\n                    </a>\r\n                  </Link>\r\n                }\r\n                datetime={\r\n                  <Tooltip title={moment(item.createdAt).format('YYYY년 MM월 DD일 HH:mm')}>\r\n                    <span>{moment(item.createdAt).fromNow()}</span>\r\n                  </Tooltip>\r\n                }\r\n                content={<CommentContent content={item.content} />}\r\n              >\r\n                {replyId === item.id && (\r\n                  <CommentForm\r\n                    placeholder=\"답글 달기\"\r\n                    type=\"reply\"\r\n                    setReplyId={setReplyId}\r\n                    replyId={replyId}\r\n                    postData={postData}\r\n                    postMutate={postMutate}\r\n                  />\r\n                )}\r\n              </CommentWrapper>\r\n            </li>\r\n          )}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nCommentSection.propTypes = {\r\n  postData: PropTypes.object.isRequired,\r\n  postMutate: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default CommentSection;\r\n"]},"metadata":{},"sourceType":"module"}